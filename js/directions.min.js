function getCity(e,r){getCityAux(e,r)}function getCityAux(e,r){var t={origin:encodeURI(e),destination:encodeURI("Tel Aviv, Israel"),language:"en"};request({url:baseURL,qs:t},function(e,t,i){if(e)return void r(!0,errorGenerator.error(15,"address"));try{var n=JSON.parse(i);checkLegalityDirectionsApiResult(n);var s=n.routes[0].legs[0];city=s.start_address.split(",")[1].trim().toLowerCase(),r(!1,city)}catch(o){r(!0,o)}})}function getTechnionWalkingTime(e,r,t){getTechnionWalkingTimeAux(e,r,null,t)}function getTechnionWalkingTimeAux(e,r,t,i){var n={origin:encodeURI(e),destination:encodeURI(r[0]),mode:"walking",language:"en"};r.splice(0,1),request({url:baseURL,qs:n},function(n,s,o){if(n)return void i(!0,errorGenerator.error(15,"address"));try{var a=JSON.parse(o);checkLegalityDirectionsApiResult(a);var u=a.routes[0].legs[0],l=Math.round(u.duration.value/60);if(null==t&&(t=l),!(r.length>0))return void i(!1,t);t=Math.min(t,l),getTechnionWalkingTimeAux(e,r,t,i)}catch(c){i(!0,c)}})}function getBusstopWalkingTime(e,r,t){getBusstopWalkingTimeAux(e,r,null,t)}function getBusstopWalkingTimeAux(e,r,t,i){var n={origin:encodeURI(e),destination:encodeURI(r[0]),mode:"transit",departure_time:"1436072400",language:"en"};r.splice(0,1),request({url:baseURL,qs:n},function(n,s,o){if(n)return void i(!0,errorGenerator.error(15,"address"));try{var a=JSON.parse(o);checkLegalityDirectionsApiResult(a),routeSteps=a.routes[0].legs[0].steps;var u=!1;for(var l in routeSteps)"TRANSIT"==routeSteps[l].travel_mode&&(u=!0);var c=null;u&&(c=Math.round(a.routes[0].legs[0].steps[0].duration.value/60)),null==t&&(t=c),r.length>0?(t=Math.min(t,c),getBusstopWalkingTimeAux(e,r,t,i)):i(!1,t)}catch(g){r.length>0?getBusstopWalkingTimeAux(e,r,t,i):null==t?i(!1,null):i(!1,t)}})}function checkLegalityDirectionsApiResult(e){if("OK"!=e.status)switch(e.status){case"NOT_FOUND":throw errorGenerator.error(12,"address");case"ZERO_RESULTS":throw errorGenerator.error(16,"address");default:throw errorGenerator.error(12,"address")}}var request=require("request"),async=require("async"),errorGenerator=require("./errorgenerator"),baseURL="http://maps.googleapis.com/maps/api/directions/json";exports.getCityAndTimes=function(e,r,t){async.parallel([function(r){getCity(e,r)},function(t){getTechnionWalkingTime(e,r.slice(0),t)},function(t){getBusstopWalkingTime(e,r.slice(0),t)}],function(e,r){if(e){for(var i in r)if(r[i].hasOwnProperty("statusCode")){t(!0,r[i]);break}}else cityAndTimes={city:r[0],technionWalkingTime:r[1],busstopWalkingTime:r[2]},t(null,cityAndTimes)})};
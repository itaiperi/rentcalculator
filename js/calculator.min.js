function getPriceOfAttribute(e,r,t,i){if(e[r].hasOwnProperty("price_type")){var a=e[r].price[i[r]],o=e[r].price_type;if(void 0==i[r])throw errorGenerator.error(14,r,r);if(typeof i[r]!=e[r].value_type)throw errorGenerator.error(10,r,typeof i[r],e[r].value_type);if(void 0==a){if("number"!=e[r].value_type)throw errorGenerator.error(11,r,i[r]);if(i[r]>e[r].price.max&&e[r].price.hasOwnProperty("over"))a=e[r].price.over;else{if(!(i[r]<e[r].price.min&&e[r].price.hasOwnProperty("under")))throw errorGenerator.error(11,r,i[r]);a=e[r].price.under}}if(e[r].hasOwnProperty("dependencies")){var p=Database;for(var n in e[r].dependencies){var s=!0,c=i;dependencyPath=e[r].dependencies[n].path;for(var l in dependencyPath)p=p[dependencyPath[l]],s||(c=c[dependencyPath[l]]),s=!1;"multiply"==e[r].dependencies[n].action&&(a*=p[c])}}t.push({price:a,price_type:o})}else{if("object"!=typeof e[r])throw errorGenerator.error(13,r,r);for(var u in e[r])getPriceOfAttribute(e[r],u,t,i[r])}}function closestLargerFiveMultiplier(e){return 5*Math.ceil(e/5)}var directions=require("./directions"),errorGenerator=require("./errorgenerator"),Database={additionalInfo:{expectedPersons:{1:1,1.5:1,2:1,2.5:1,3:2,3.5:2,4:3,4.5:3,5:4,5.5:4,min:1,max:5.5},arrangement:{roommmates:"roommates",couple:"couple",single:"single"},roommates:{2:2,3:3,4:4,min:2,max:4},elevator:{"true":1,"false":-1}},prices:{rooms:{price:{1:1550,1.5:1850,2:2200,2.5:2450,3:2500,3.5:2600,4:3250,4.5:3350,5:4150,5.5:4250,min:1,max:5.5},value_type:"number",price_type:"base"},city:{price:{haifa:1,nesher:.9},value_type:"string",price_type:"multiplier"},renovationLevel:{price:{old:.8,decent:1,renovated:1.08,premium:1.2},value_type:"string",price_type:"multiplier"},apartmentSize:{price:{small:.94,regular:1,large:1.08},value_type:"string",price_type:"multiplier"},roomSize:{price:{small:.94,regular:1,large:1.08},value_type:"string",price_type:"multiplier"},floor:{price:{"-3":20,"-2":10,"-1":0,0:0,1:0,2:10,3:20,min:-3,max:3,under:25,over:25},value_type:"number",price_type:"fixed_apartment",dependencies:[{path:["additionalInfo","elevator"],action:"multiply"}]},electricalAppliances:{refrigerator:{price:{"true":0,"false":-50},value_type:"boolean",price_type:"fixed_apartment"},laundryMachine:{price:{"true":50,"false":0},value_type:"boolean",price_type:"fixed_apartment"},oven:{price:{"true":25,"false":0},value_type:"boolean",price_type:"fixed_apartment"}},garden:{price:{"true":150,"false":0},value_type:"boolean",price_type:"fixed_apartment"},balcony:{price:{"true":100,"false":0},value_type:"boolean",price_type:"fixed_apartment"},apartmentFurniture:{price:{full:50,partial:0,none:-50},value_type:"string",price_type:"fixed_apartment"},technionWalkingTime:{price:{0:250,5:250,10:0,15:-100,20:-150,min:0,max:20,over:-200},value_type:"number",price_type:"fixed_apartment"},airConditioning:{livingroom:{price:{"true":20,"false":0},value_type:"boolean",price_type:"fixed_apartment"},bedroom:{price:{"true":40,"false":0},value_type:"boolean",price_type:"fixed_room"}},roomParentUnit:{price:{"true":200,"false":0},value_type:"boolean",price_type:"fixed_room"},roomFurniture:{price:{full:50,partial:0,none:-50},value_type:"string",price_type:"fixed_room"}},destinationCoordinates:["32.778581,35.015598","32.781417,35.023345","32.774235,35.029547","32.772995,35.029032"]};exports.calculate=function(e,r){function t(t,o){if(t)return a.push(o),void r({statusCode:1,status:"Errors were found.",errors:a});for(var p in o)e[p]="technionWalkingTime"==p||"busstopWalkingTime"==p?closestLargerFiveMultiplier(o[p]):o[p];var n=[];for(var p in Database.prices)try{getPriceOfAttribute(Database.prices,p,n,e)}catch(s){var c={component:s.component,statusCode:s.statusCode,status:s.status};a.push(c)}return 0!=a.length?(console.log("SEVERE: errors in evaluateParameters:",a),void r({statusCode:1,status:"Errors were found.",errors:a})):void i(n)}function i(t){var i={base:0,multiplier:1,fixed_apartment:0,fixed_room:0};for(var a in t)i[t[a].price_type]="multiplier"==t[a].price_type?i[t[a].price_type]*t[a].price:i[t[a].price_type]+t[a].price;price=i.base*i.multiplier+i.fixed_apartment,"roommates"==e.arrangement&&(price/=e.roommates),price+=i.fixed_room,r({statusCode:0,status:"OK",price:price})}var a=[],o=e.address;return"string"!=typeof o?(a.push(errorGenerator.error(10,"address",typeof o,"string")),void r({statusCode:1,status:"Errors were found.",errors:a})):void directions.getCityAndTimes(o,Database.destinationCoordinates,t)};